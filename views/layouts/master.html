{% import '../macros/macros.html' as macros %}
<!doctype html>
<html lang="en">
<head>
  {# Temporarily off
   Guests always get the mobile version
  {% if !ctx.currUser %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
  {% endif %}
  {% if ctx.currUser && ctx.currUser.force_device_width %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
  {% endif %}
  #}
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="keywords" content="roleplay forum, forum based roleplay, play by post, rp forum, roleplaying forum, rpg forum">
  <meta name="description" content="Laid-back and free-form roleplaying. From fandoms to original plots, you'll find other players that share your interests. Roleplays are organized by skill-level and tags.">
  <title>
    {% if title %}
      {{ title }} &mdash; Roleplayer Guild
    {% else %}
      Roleplayer Guild &mdash; Play-by-Post Forum Roleplaying
    {% endif %}
  </title>

  {% if ctx.dist && ctx.dist.css %}
    <link rel="stylesheet" href="/{{ ctx.dist.css }}">
  {% else %}
    <!-- Bootstrap CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/vendor/bootstrap/css/bootstrap-theme.css" rel="stylesheet">
    <!-- Other 3rd party CSS -->
    <link href="/vendor/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="/vendor/bootstrap-markdown/css/bootstrap-markdown.min.css" rel="stylesheet">
    <!-- RPGuild CSS -->
    <link href="/css/bootstrap_overrides.css" rel="stylesheet">
    <link href="/css/general.css" rel="stylesheet">
  {% endif %}

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  {% block head %}{% endblock %}
</head>
<body class="{{ className || '' }}">
<div class="container">

  <div id="top-bottom-box">
    <a class="top-btn" href="#" title="Go to top">
      <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
    <a class="bottom-btn" href="#bottom" title="Go to bottom">
      <span class="glyphicon glyphicon-chevron-down"></span>
    </a>
  </div>

    {% if ctx.path === '/' && ctx.config.NODE_ENV === 'production' %}
      <h1 id="tagline">Play-by-Post Forum Roleplay Gaming</h1>
    {% endif %}

    <!-- Static navbar -->
    <nav class="navbar navbar-inverse" role="navigation"
         style="">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            {% if ctx.config.NODE_ENV === 'production' %}
              Roleplayer Guild
            {% else %}
              {{ ctx.config.NODE_ENV }}-guild
            {% endif %}
          </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <!-- <li><a href="/search">Search</a></li> -->
            <li><a href="http://widget02.mibbit.com/?settings=c2129339a43d8c49d86c34fa8dff7610&server=irc.foonetic.net&channel=%23Roleplayerguild" target="_blank">Chat</a></li>
            <li><a href="https://www.facebook.com/groups/343860060223/" target="_blank">Facebook</a></li>
            <li><a href="/staff">Staff</a></li>
            {% if ctx.can(ctx.currUser, 'READ_USER_LIST') %}
              <li><a href="/users">Users</a></li>
            {% endif %}
          </ul>

          <!-- If user is logged in, show logout button -->
          {% if ctx.currUser %}
            <form style="padding-top:3px;"
                  action="/me/logout"
                  method="post"
                  class="logout-form navbar-form pull-right">
              <input type="submit"
                     value="Logout"
                     style="color: white;"
                     class="btn-link">
            </form>

            <div class="hidden-xs">
              {{ macros.renderUserBar(true, 'pull-right') }}
            </div>
          {% endif %}
          <!-- If user is not logged in, show login/register controls -->
          {% if !ctx.currUser %}
            <div class="navbar-right">
              <a class="btn btn-default navbar-btn" href="/login" id="login-btn">
                Login
              </a>
              <a class="btn btn-primary navbar-btn" href="/register" id="register-btn">
                Register
              </a>
            </div>
          {% endif %}

        </div><!--/.nav-collapse -->
      </div><!--/.container-fluid -->
    </nav><!-- /navbar -->

    <!-- userbar for mobile users -->
    {% if ctx.currUser %}
      <div class="text-center visible-xs-block">
        {{ macros.renderUserBar(false) }}
      </div>
    {% endif %}

    <!-- Display flash message -->
    {% if ctx.flash && ctx.flash.message %}
      <div class="alert alert-{{= ctx.flash.message[0] }}"
           role="alert">
        {{ ctx.flash.message[1] }}
      </div>
    {% endif %}

    <!-- Embedded content is nested here -->
    {% block embed %}{% endblock %}

    <a name="bottom"></a>

    <!-- Footer -->
    <div class="text-center" style="margin-top: 100px;">
      &copy; 2007-2015 &mdash; Source on <a href="https://github.com/danneu/guild">Github</a>
      <div><a href="/bbcode">BBCode Cheatsheet</a></div>
    </div>

  </div> <!-- /container -->

  <!-- JS -->
  {% if ctx.dist && ctx.dist.js %}
    <script src="/{{ ctx.dist.js }}"></script>
  {% else %}
    <script src="/vendor/jquery/jquery-2.1.3.min.js"></script>
    <script src="/vendor/jquery-hotkeys/jquery.hotkeys.js"></script>
    <script src="/vendor/timeago/jquery.timeago.js"></script>
    <script src="/vendor/markdown/markdown.js"></script>
    <script src="/vendor/bootstrap-markdown/js/bootstrap-markdown.js"></script>
    <script src="/vendor/jquery-appear/jquery.appear.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="/vendor/xbbcode/xbbcode/bbcode.js"></script>
    <script src="/js/bbcode_editor.js"></script>
  {% endif %}
  <script>
    $.timeago.settings.allowFuture = true;
    $.timeago.settings.strings = {
      prefixAgo: null,
      prefixFromNow: "in",
      suffixAgo: "ago",
      suffixFromNow: "",
      seconds: "<1 min",
      minute: "1 min",
      minutes: "%d min",
      hour: "1 hour",
      hours: "%d hours",
      day: "1 day",
      days: "%d days",
      month: "1 month",
      months: "%d months",
      year: "1 year",
      years: "%d years",
      wordSeparator: " ",
      numbers: []
    };
  </script>
  <script>
    $(function() {
      $("abbr.timeago").timeago();
    });
  </script>
  <script>
    // Activate cheatsheet toggle
    var isCheatsheetRendered = false;
    $('#cheatsheet-toggle-btn').on('click', function() {
      // Only render the BBCode demos on first click and never again
      if (!isCheatsheetRendered) {
        console.log('rendering cheatsheet');
        $('#bbcode-cheatsheet .bbcode').each(function() {
          $(this).html(XBBCODE.process({
            text: $(this).text(),
            addInLineBreaks: true
          }).html);
        });
        isCheatsheetRendered = true;
      }
      $('#cheatsheet-body').toggle();
    });
  </script>
  <script>
    //$('.hider-button').click(function(e) {
    // Bind to any hiders that are created after page load (i.e. hiders
    // in preview boxes)
    $(document).ready(function() {
      $(document).on('click', '.hider-button', function(e) {
         console.log('click');
         e.stopPropagation();
         //$(this).next().toggle();


         var $button = $(this);
         console.log($button);
         var hiderName = $button.attr('data-name');
         var $content = $button.parent().next();
         console.log('$content', $content);
         console.log('expr', $content.css('display'));

         if ($content.css('display') === 'none') {
           $content.show();
           $button.parent().parent().css('border', '1px solid #111')
           $button.text(hiderName + ' [-]');
         } else {
           $content.hide();
           $button.parent().parent().css('border', 'none')
           $button.text(hiderName + ' [+]');
         }

         return false;
       })
    });
  </script>

  <script type="text/javascript">
    // Is localStorage supported in this browser?
    function isStorage() {
      var key = 'test';
      try {
          localStorage.setItem(key, key);
          localStorage.removeItem(key);
          return true;
      } catch(ex) {
          return false;
      }
    }
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
